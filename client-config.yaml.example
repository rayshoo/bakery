global:
  # ecs or k8s
  platform: ecs

  # amd64 or arm64
  arch: amd64

  # Environment variables for the container launched on ecs or k8s
  env:
    foo: bar

  # Script to run before executing kaniko when the kaniko container is launched on ecs
  pre-script: |
    echo 'this is original pre script' > pre.txt

  # Script to run after a successful kaniko build. Skipped on build failure.
  post-script: |
    echo 'this is post script' > post.txt

  # Credentials listed here are saved to /kaniko/.docker/config.json before kaniko runs.
  kaniko-credentials:
  - registry: registry.example.com
    username: user
    password: password
  - registry: cache.example.com
    username: cache
    password: password

  kaniko:
    # Relative to /workspace (default cmd.dir). Defaults to '.'
    context-path: .
    # Server default, but can be explicitly overridden
    dockerfile: Dockerfile
    build-args:
      BUILD_BASE_IMAGE_NAME: golang
      BUILD_BASE_IMAGE_TAG: 1.25.4-alpine3.22
      BASE_IMAGE_NAME: alpine
      BASE_IMAGE_TAG: latest
    cache:
      enable: true
      repo: cache.example.com
      ttl: 24h
      copy-layers: true
      run-layers: true
      compressed: false
    snapshot-mode: redo
    use-new-run: true
    cleanup: true
    custom-platform: linux/amd64
    ignore-path: []
    destination: registry.example.com/repo/foo:bar
    no-push: false
    extra-flags: ''

bake:
- arch: amd64

  # Merged with global env; duplicate keys are overridden by bake values
  env:
    foo1: bar1

  kaniko:
    # container-name is optional, defaults to kaniko
    # container-name: kaniko

    # Overrides global.kaniko.context-path
    # context-path: /workspace/src

    # Overrides global.kaniko.dockerfile
    # dockerfile: Dockerfile

    # All other global.kaniko options can be overridden here as well

    # Merged with global.kaniko.build-args; duplicate keys are overridden by bake values
    build-args:
      BUILD_PLATFORM: amd64

- arch: arm64
  # Overrides global.pre-script
  pre-script: |
    echo 'this is overrided pre script' > pre.txt

  # Overrides global.post-script
  post-script: ''

  # Overrides global.kaniko-credentials entirely (all-or-nothing)
  kaniko-credentials:
  - registry: registry.example.com
    username: user
    password: password
  - registry: cache.example.com
    username: cache
    password: password

  kaniko:
    image:
      # Overrides global.kaniko.image.secret. An empty array disables docker credential storage.
      secret:
      - registry: registry.example.com
        username: user
        password: password

    # container-name is optional, defaults to kaniko
    container-name: kaniko-arm64

    # Overrides global.kaniko.context-path
    context-path: /workspace/src

    # Overrides global.kaniko.dockerfile
    dockerfile: Dockerfile.arm64

    # All other global.kaniko options can be overridden here as well

    # Merged with global.env; duplicate keys are overridden by bake values
    env:
      foo2: bar2

    # Merged with global.kaniko.build-args; duplicate keys are overridden by bake values
    build-args:
      BUILD_PLATFORM: arm64
